{
  "openapi": "3.0.3",
  "info": {
    "title": "BitRobot API",
    "description": "The BitRobot API allows you to interact with the BitRobot platform, including event tracking, task management, and points distribution.\n\n## Authentication\n\nAll requests require authentication using an API key. Include your API key in the `Authorization` header:\n\n```\nAuthorization: Bearer brb_your_api_key_here\n```\n\n## Identifiers\n\nAll resource identifiers in the API use the ULID format (Universally Unique Lexicographically Sortable Identifier).\n",
    "version": "1.0.0",
    "contact": {
      "name": "BitRobot API Support"
    }
  },
  "servers": [
    {
      "url": "https://api.bitrobot.com",
      "description": "Production server"
    },
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    }
  ],
  "paths": {
    "/subnets/{subnet_id}/events": {
      "post": {
        "summary": "Create a new event",
        "description": "Creates a new event in the system. The behavior depends on the `event_type` provided:\n\n- **ride_start**: Creates a new task run and initiates video recording\n- **ride_end**: Completes an existing task run and stops video recording\n- **points_grant**: Grants points to a user's wallet address\n",
        "operationId": "createEvent",
        "tags": ["Events"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "subnet_id",
            "in": "path",
            "required": true,
            "description": "The unique identifier of the subnet (ULID format)",
            "schema": {
              "type": "string",
              "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$"
            },
            "example": "01ARZ3NDEKTSV4RRFFQ69G5FAV"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "oneOf": [
                  {
                    "$ref": "#/components/schemas/RideStartEvent"
                  },
                  {
                    "$ref": "#/components/schemas/RideEndEvent"
                  },
                  {
                    "$ref": "#/components/schemas/PointsGrantEvent"
                  }
                ],
                "discriminator": {
                  "propertyName": "event_type"
                }
              },
              "examples": {
                "rideStart": {
                  "summary": "Ride Start Event",
                  "value": {
                    "event_type": "ride_start",
                    "task_id": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
                    "ride_id": "ride_123456",
                    "bot_name": "bot_001"
                  }
                },
                "rideEnd": {
                  "summary": "Ride End Event",
                  "value": {
                    "event_type": "ride_end",
                    "task_id": "01ARZ3NDEKTSV4RRFFQ69G5FAV"
                  }
                },
                "pointsGrant": {
                  "summary": "Points Grant Event",
                  "value": {
                    "event_type": "points_grant",
                    "wallet_address": "HN7cABqLq46Es1jh92dQQisAq662SmxELLLsHHe4YWrH",
                    "points": 100,
                    "reason": "Task completion bonus",
                    "client_ref": "task_123_completion",
                    "granted_at": "2025-10-22T12:00:00Z"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Event created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["status", "data"],
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["success"],
                      "example": "success"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "task_run_id": {
                          "type": "string",
                          "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$",
                          "nullable": true,
                          "description": "ID of the created or updated task run (for ride_start and ride_end events)",
                          "example": "01ARZ3NDEKTSV4RRFFQ69G5FAV"
                        },
                        "recording_id": {
                          "type": "string",
                          "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$",
                          "nullable": true,
                          "description": "ID of the video recording (for ride_start and ride_end events)",
                          "example": "01ARZ3NDEKTSV4RRFFQ69G5FAW"
                        },
                        "ledger_id": {
                          "type": "string",
                          "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$",
                          "nullable": true,
                          "description": "ID of the points ledger entry (for points_grant events)",
                          "example": "01ARZ3NDEKTSV4RRFFQ69G5FAX"
                        }
                      }
                    }
                  }
                },
                "examples": {
                  "rideStartSuccess": {
                    "summary": "Ride Start Success Response",
                    "value": {
                      "status": "success",
                      "data": {
                        "task_run_id": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
                        "recording_id": "01ARZ3NDEKTSV4RRFFQ69G5FAW",
                        "ledger_id": null
                      }
                    }
                  },
                  "rideEndSuccess": {
                    "summary": "Ride End Success Response",
                    "value": {
                      "status": "success",
                      "data": {
                        "task_run_id": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
                        "recording_id": "01ARZ3NDEKTSV4RRFFQ69G5FAW",
                        "ledger_id": null
                      }
                    }
                  },
                  "pointsGrantSuccess": {
                    "summary": "Points Grant Success Response",
                    "value": {
                      "status": "success",
                      "data": {
                        "task_run_id": null,
                        "recording_id": null,
                        "ledger_id": "01ARZ3NDEKTSV4RRFFQ69G5FAX"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing API key",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "Invalid or missing API key"
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity - Invalid event data or unknown event type",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["status", "error"],
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["error"],
                      "example": "error"
                    },
                    "error": {
                      "type": "string",
                      "description": "Description of the error",
                      "example": "Unknown event type: invalid_type"
                    }
                  }
                },
                "examples": {
                  "unknownEventType": {
                    "summary": "Unknown Event Type",
                    "value": {
                      "status": "error",
                      "error": "Unknown event type: invalid_type"
                    }
                  },
                  "validationError": {
                    "summary": "Validation Error",
                    "value": {
                      "status": "error",
                      "error": "Wallet address is required"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "API Key",
        "description": "API key authentication. Your API key should start with `brb_`.\n\nExample: `Authorization: Bearer brb_1234567890abcdef`\n"
      }
    },
    "schemas": {
      "RideStartEvent": {
        "type": "object",
        "required": ["event_type", "task_id", "ride_id", "bot_name"],
        "properties": {
          "event_type": {
            "type": "string",
            "enum": ["ride_start"],
            "description": "The type of event"
          },
          "task_id": {
            "type": "string",
            "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$",
            "description": "The unique identifier of the task (ULID format)",
            "example": "01ARZ3NDEKTSV4RRFFQ69G5FAV"
          },
          "ride_id": {
            "type": "string",
            "description": "The unique identifier for this ride session",
            "example": "ride_123456"
          },
          "bot_name": {
            "type": "string",
            "description": "The name of the bot performing the task",
            "example": "bot_001"
          }
        },
        "example": {
          "event_type": "ride_start",
          "task_id": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
          "ride_id": "ride_123456",
          "bot_name": "bot_001"
        }
      },
      "RideEndEvent": {
        "type": "object",
        "required": ["event_type", "task_id"],
        "properties": {
          "event_type": {
            "type": "string",
            "enum": ["ride_end"],
            "description": "The type of event"
          },
          "task_id": {
            "type": "string",
            "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$",
            "description": "The unique identifier of the task to complete (ULID format)",
            "example": "01ARZ3NDEKTSV4RRFFQ69G5FAV"
          }
        },
        "example": {
          "event_type": "ride_end",
          "task_id": "01ARZ3NDEKTSV4RRFFQ69G5FAV"
        }
      },
      "PointsGrantEvent": {
        "type": "object",
        "required": ["event_type", "wallet_address", "points", "reason"],
        "properties": {
          "event_type": {
            "type": "string",
            "enum": ["points_grant"],
            "description": "The type of event"
          },
          "wallet_address": {
            "type": "string",
            "description": "The Solana wallet address to grant points to",
            "example": "HN7cABqLq46Es1jh92dQQisAq662SmxELLLsHHe4YWrH"
          },
          "points": {
            "type": "integer",
            "minimum": 1,
            "description": "The number of points to grant (must be greater than 0)",
            "example": 100
          },
          "reason": {
            "type": "string",
            "description": "The reason for granting these points",
            "example": "Task completion bonus"
          },
          "client_ref": {
            "type": "string",
            "description": "Optional client reference ID for idempotency and tracking",
            "example": "task_123_completion"
          },
          "granted_at": {
            "type": "string",
            "format": "date-time",
            "description": "Optional timestamp when the points were granted (ISO 8601 format)",
            "example": "2025-10-22T12:00:00Z"
          }
        },
        "example": {
          "event_type": "points_grant",
          "wallet_address": "HN7cABqLq46Es1jh92dQQisAq662SmxELLLsHHe4YWrH",
          "points": 100,
          "reason": "Task completion bonus",
          "client_ref": "task_123_completion",
          "granted_at": "2025-10-22T12:00:00Z"
        }
      },
      "Error": {
        "type": "object",
        "required": ["error"],
        "properties": {
          "error": {
            "type": "string",
            "description": "Description of the error",
            "example": "Invalid or missing API key"
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Events",
      "description": "Event tracking and management endpoints.\n\nEvents allow you to track important actions and state changes in your subnet,\nincluding task execution (rides) and points distribution.\n"
    }
  ]
}
